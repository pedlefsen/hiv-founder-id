---
title: Document Tracking Tests Under Active Development
output: 
  html_document:
    toc: false
    theme: cerulean
---

```{r setup-and-config, include = FALSE}
library(tools)
library(knitr)
pipeline_dir <- '/home/phillipl/projects/hiv-founder-id/code/hiv-founder-id'
knitr::opts_chunk$set(echo = FALSE)

source('test_utils.R')
```

## Overview

This document is used to develop tests for the hiv-founder-id pipeline.

The basic testing procedure is:

1) Use a bash chunk to call the pipeline line with a call to perl specifying all the options, including the output directory. Testing output goes in `tests/tmp/test_x` folders
2) Check for the existence of the correct files and folders in `tests/tmp/test_x` against `tests/refs/test_x`.
3) If any files are missing, or if there are extra files, print out the names of the offending files.
4) Ensure that all the files are 'identical' - there might be timestamps etc that need to be ignored.
5) If any files are not identical, print out the names of the files that are not identical.
6) If the primery result file `identify_founders.tab` have mismatches, print out the column names that mismatch, as well as the values in the two files.

**It seems like the commands cannot be run with system from within R, so populate command scripts in the commands folder and then just run them manually**

## The tests

### test_001

```{r, include = FALSE}
c_test_name <- 'test_001'
fasta_file <- 'ld_seqs.fasta'
command_flags <- '-CPRFHT'
test_description <- 'Entropy only on ld_seqs.fasta'
```

```{r}
test_result <-
  conduct_test(c_test_name = c_test_name,
               fasta_file = fasta_file,
               command_flags = command_flags,
               test_description = test_description,
               pipeline_dir = pipeline_dir)

if (class(test_result) == 'character'){
  for (i in 1:20){
    cat(paste('\n\n', test_result, '\n\n', sep = ''))
  }
} else {
  kable(test_result$test_result)
}
```

### test_002

```{r, include = FALSE}
c_test_name <- 'test_002'
fasta_file <- 'ld_seqs.fasta'
command_flags <- '-PRFHT'
test_description <- 'Entropy, PhyML and Insites on ld_seqs.fasta'
```

```{r}
test_result <-
  conduct_test(c_test_name = c_test_name,
               fasta_file = fasta_file,
               command_flags = command_flags,
               test_description = test_description,
               pipeline_dir = pipeline_dir)

if (class(test_result) == 'character'){
  for (i in 1:20){
    cat(paste('\n\n', test_result, '\n\n', sep = ''))
  }
} else {
  kable(test_result$test_result)
}
```





```{r, eval = FALSE}

test_result <-
  conduct_test(c_test_name = c_test_name,
               fasta_file = fasta_file,
               command_flags = command_flags,
               test_description = test_description,
               pipeline_dir = pipeline_dir,
               write_new_command = TRUE)

```

